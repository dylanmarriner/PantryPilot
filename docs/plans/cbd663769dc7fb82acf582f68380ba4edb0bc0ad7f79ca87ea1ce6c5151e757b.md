<!--
ATLAS-GATE_PLAN_HASH: cbd663769dc7fb82acf582f68380ba4edb0bc0ad7f79ca87ea1ce6c5151e757b
COSIGN_SIGNATURE: MEYCIQC8cP6mc1sLGri5NubVzOlfmdTitmwsoGviNYdacNLMcQIhAKI7ZaMSSB8NTZLzOn0Vi35ILYIBYjEa86UwqXBNfKc0
ROLE: ANTIGRAVITY
STATUS: APPROVED
-->

# Plan Metadata

Plan ID: PLAN_PANTRYPILOT_PHASE_1_V1
Version: 1.0
Author: ANTIGRAVITY
Status: APPROVED
Timestamp: 2026-02-14T06:15:00Z
Governance: ATLAS-GATE-v1

# Scope & Constraints

Objective: Implement the Core Data and Inventory Engine for PantryPilot as defined in Phase 1 of the roadmap. This includes the core data models, unit normalization layer, and inventory management logic.

Affected Files:
- backend/package.json: Initialize node project and dependencies
- backend/src/models/household.js: Define Household schema
- backend/src/models/user.js: Define User schema
- backend/src/models/item.js: Define Item, Category, and Location schemas
- backend/src/models/stock_entry.js: Define StockEntry, Unit, and Expiry schemas
- backend/src/services/inventory.js: Implement add, adjust, and deduct quantity logic
- backend/src/services/unit_converter.js: Implement unit normalization and g/kg/ml/L conversions
- backend/tests/unit_converter.test.js: Unit tests for deterministic unit math
- backend/tests/inventory.test.js: Functional tests for stock operations

Out of Scope:
- AI interpretation layer (Phase 5)
- Pricing engine logic (Phase 2)
- Mobile application frontend (Phase 6)
- Database migration execution (schema definition only)

Constraints:
- MUST ensure all stock math is 100% deterministic
- MUST implement unit normalization for g, kg, ml, L, and count
- MUST NOT include any AI-related libraries or logic
- MUST NOT use floating point math for currency or critical stock quantities (use integers/sub-units)
- MUST handle partial usage and reorder threshold triggers
- MUST NOT depend on external APIs for unit conversion

# Phase Definitions

## Phase: PHASE_1

Phase ID: PHASE_1
Objective: Build the deterministic inventory engine and core data models
Allowed operations: CREATE, MODIFY
Forbidden operations: DELETE
Required intent artifacts: Backend models, Service layer, Unit tests
Verification commands: npm --prefix backend install && npm --prefix backend test
Expected outcomes: All models implemented, unit conversion tests passing, inventory operations verified
Failure stop conditions: Verification failure, Hash mismatch, Path allowlist violation, Syntax error, Spectral lint failure

# Path Allowlist

- backend/
- docs/plans/
- package.json

# Verification Gates

## Gate 1: Structural Integrity
Trigger: After file creation
Check: ls -R backend/src/models
Required: All required model files must exist
Failure: REJECT and ROLLBACK

## Gate 2: Logic Validation
Trigger: After service implementation
Check: npm --prefix backend test
Required: 100% test pass rate for inventory and unit conversion
Failure: REJECT and ROLLBACK

## Gate 3: Governance Compliance
Trigger: Before approval
Check: Verify only files in Path Allowlist were modified
Required: Zero violations detected
Failure: REJECT

# Forbidden Actions

Actions STRICTLY PROHIBITED:

- DELETE any existing files in docs/
- MODIFY files outside the backend/ or docs/plans/ directories
- Execute arbitrary shell commands unrelated to project setup
- MUST NOT include incomplete logic or unfinished markers
- MUST NOT write fake implementations for core inventory services
- MUST NOT bypass verification commands
- MUST NOT use ambiguous language in documentation or code

# Rollback / Failure Policy

## Automatic Rollback Triggers
1. Verification gate fails (Gate 1 or Gate 2)
2. Path allowlist violation detected
3. Hash mismatch in plan execution
4. Syntax errors in implemented JavaScript files

## Rollback Procedure
1. Execute: git checkout backend/ package.json
2. Delete any newly created files in backend/ and docs/plans/
3. Verify workspace state matches pre-execution baseline via git status
4. Create audit log entry documenting the failure and rollback action

## Recovery
1. Review failure logs in audit-log.jsonl
2. Identify root cause of verification or compliance failure
3. Modify the implementation plan to address requirements
4. Resubmit plan for linting and approval
